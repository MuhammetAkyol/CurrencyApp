@using EntityLayer.Concrete
@model List<CurrencyRate>

@{
    ViewData["Title"] = "Güncel Döviz Kurları";
}

<h1 class="text-center my-4">@ViewData["Title"]</h1>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow">
                <div class="card-header bg-primary text-white text-center">
                    <h4>Döviz Kurları</h4>
                </div>
                <div class="card-body">
                    <input type="date" id="datePicker" class="form-control mb-3" />
                    <button id="fetchRates" class="btn btn-primary mb-3">Verileri Getir</button>
                    <table id="ratesTable" class="table table-striped table-hover">
                        <thead class="thead-dark">
                            <tr>
                                <th class="text-center">Para Birimi</th>
                                <th class="text-center">Alış Kuru</th>
                                <th class="text-center">Tarih</th>
                            </tr>
                        </thead>
                        <tbody id="ratesBody">
                            <tr>
                                <td colspan="3" class="text-center">Veri bulunamadı.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    $(document).ready(function () {
        $("#fetchRates").click(function () {
            var selectedDate = $("#datePicker").val();
            if (selectedDate) {
                $.ajax({
                    url: '@Url.Action("GetRatesByDate", "Currency")', // Action ismi ve controller ismini buraya yaz
                    type: 'GET',
                    data: { date: selectedDate },
                    success: function (data) {
                        var tbody = $("#ratesBody");
                        tbody.empty(); // Mevcut satırları temizle
                        if (data.length > 0) {
                            $.each(data, function (index, rate) {
                                tbody.append(`
                                        <tr>
                                            <td class="text-center">${rate.currencyCode}</td>
                                            <td class="text-center">${(rate.buyingRate / 10000).toFixed(4)}</td>
                                            <td class="text-center">${new Date(rate.date).toLocaleString()}</td>
                                        </tr>
                                    `);
                            });
                        } else {
                            tbody.append(`<tr><td colspan="3" class="text-center">Veri bulunamadı.</td></tr>`);
                        }
                    },
                    error: function () {
                        alert('Bir hata oluştu.');
                    }
                });
            } else {
                alert('Lütfen bir tarih seçin.');
            }
        });
    });
</script>
